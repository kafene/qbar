<?php ob_start() ?>
<!DOCTYPE HTML>
<html lang="en">
<head>
  <title>Q bar</title>
  <meta charset="utf-8">
  <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAB1UlEQVQ4y43TQUvUURQF8N+MkIymjROz1UVlSISGERIuhnBriz5AHyEI3Aa1aOfGRRFIZJKQEGjtg5IUIkoTCTRCCKmgcUhHkKbx/1rMH51xxui+zXv3nPPefYd7E2qjWYtTMoKCdTtKh3CJqn3aFcP6dGlH0br3XnilqGH0mrErEqpWZNuUnkb0nJWY8tuG1+Z8U4plywbrb1+JwXk3DTgp67IRS3F2Ua+a2mdiYFynZNX/ukwKImUTWg8E1+zG9La6UjtMiwR5QwdGPhKJzOtsaEa3VUEwVnE0qUWfhD+e2WgoWPMEDEhXEhcVBBsGHBX9tgSbFUZSRju++Hyk4JOPSMtWBCF2JHmkIBljoXIoKOK0M3W0nOuacE4vfslXgIwPgpKRmr5iyFdl9zS7IwgWZCrAMeMiwZKuGsENQaRk1ndBMHoADdsWBJM6qgQps/b22/CH3AHUZipOT+uukmS8i/NlD7RUP99jWRCJrLqlX0qrS277GXdwZPzQDw1aVI7v2zLnjWJ82hNEgruaDrf4hHzN+FRqf+hlvB+VqpW0GjLmrU179mxaMCon5YSnsWNjmhN1M552VlaQt6awPzGPXcWOC/4zsp4ruV/r1b+j3XnH+Qv708Uh1/U+PAAAAABJRU5ErkJggg==">
</head>
<body>
  <div id="config" style="display:none">
(g)oogle https://google.com /search?q=%s
(o)pen https://google.com/search?btnI=1 &q=%s
(y)outube https://www.youtube.com /results?search_query=%s
(m)aps https://maps.google.com /maps?q=%s
(i)mages https://google.com/search?tbm=isch &q=%s
(d)uck https://duckduckgo.com /?k1=-1&kp=-1&q=%s
(wa)lpha http://www.wolframalpha.com /input/?i=%s
(gh)ub https://github.com /search?type=Repositories&q=%s
(bb)ucket https://bitbucket.org /repo/all?name=%s
(tw)iter https://twitter.com /search?q=%s
(a)lternative http://alternativeto.net /SearchResult.aspx?profile=all&search=%s
(w)ikipedia https://cs.wikipedia.org /w/index.php?search=%s
(c)sfd http://www.csfd.cz /hledat/?q=%s
(r)lslog http://www.rlslog.net /?s=%s
(u)lozto http://www.uloz.to /hledej/?q=%s
(pb)ay https://thepiratebay.se /search/%s/0/7/0
(t)itulky http://www.titulky.com /index.php?Fulltext=%s
(cs) http://translate.google.com/#en|cs|%s
(en) http://translate.google.com/#cs|en|%s
(mp)hp http://php.net/manual-lookup.php?pattern=%s
(mc)ss http://dochub.io/#css/%s
(mj)s http://dochub.io/#javascript/%s
(mh)tml http://dochub.io/#html/%s
(f)eedly http://feedly.com/home
(rss) https://reader.google.com
(gm)ail https://mail.google.com
(gp)lus https://plus.google.com
(db)ox https://dropbox.com
(gb)ar https://gimmebar.com
(x)kcd https://xkcd.com/
(p)ocket https://getpocket.com
(ic)on http://iconmonstr.com /?s=%s
(l)ocalhost http://localhost
  </div>
  <form id="form" action="" method="GET">
    <input id="q" type="text" name="q" value="" autofocus />
    <input type="submit" value="Q" />
  </form>
  <div id="list"></div>
</body>
<style>
  body{
    margin: 4em auto;
    max-width: 30em;
    font-size: 16pt;
  }
  a{
    color: #222;
    text-decoration: none;
    padding: .3em;
  }
  form{
    margin: 1em;
  }
  input{
    padding: .3em;
    font-size: 100%;
    font-family: inherit
    border: 1px solid #aaa;
  }
  input[type='text']{
    width: 20em;
  }
  input[type='submit']{
    padding: .3em 1em;
  }
</style>
<script>
  config = document.getElementById('config').innerHTML.split("\n")
  bookmarks = {}
  for (i in config){
    if (config[i].replace(/\s/g, '') != ''){
      title = config[i].split(' ')[0]
      titleHtml = title.replace(/\((.*)\)/, '<b>$1</b>')
      key = title.replace(/.*\((.*)\).*/, '$1')
      url = config[i].split(' ')[1].replace(/([\?&][a-z_\-]+=)?%s/i, '')
      urlSearch = config[i].substr(title.length).replace(/\ /g, '').replace(/&amp;/, '&')
      bookmarks[key] = {url:url, urlSearch:urlSearch}
      document.getElementById('list').innerHTML
        += '<a href="' + url + '">' + titleHtml + '</a> '
    }
  }
  function search(q){
    q = q.replace(/(^\s+|\s+$)/, '').replace(/\s+/g, ' ')
    a = q.split(' ')[0]
    if (q.match(/https?:\/\/.*/))
      url = q
    else{
      if (q.substr(-1) == '.'){
        a = 'o'
        q = q.replace(/.$/, '')
      }
      else if (typeof(bookmarks[a]) != 'undefined')
        q = q.substr(a.length + 1)
      else
        a = 'g'
      if (q.match(/^\s*$/))
        url = bookmarks[a].url
      else
        url = bookmarks[a].urlSearch.replace(/%s/, q)
    }
    location = url
  }
  function getParam() {
    a = {}
    window.location.href.replace(/[?&]+([^=&]+)=?([^&]*)/gi, 
      function(m,k,v){
        try{ a[k] = decodeURIComponent(v).replace(/\+/g, ' ') }
        catch(err){ a[k] = '' } // %s bug in firefox
      })
    return a
  }
  window.onload = function(){
    q = document.getElementById('q')
    q.value = ''
    q.focus()
    form = document.getElementById('form').onsubmit = function(){
      search(q.value)
      return false
    }
    if (getParam().q){
      q.value = getParam().q
      search(q.value)
    }
  }
</script>
<!--
<?php
  $q = isset($_GET['q']) ? $_GET['q'] : null;
  if (!empty($q) && $q != '%s'){
    $config = preg_replace(';.*<div id="config"[^>]*>([^<]*)</div>.*;s', '\1', file_get_contents(__FILE__));
    $config = explode("\n", $config);
    $bookmarks = array();
    foreach ($config as $line){
      if (!preg_match('/^\s*$/', $line)){
        $parts = explode(' ', $line);
        $title = $parts[0];
        $key = preg_replace('/.*\((.*)\).*/', '$1', $title);
        $url = preg_replace('/([\?&][a-z_\-]+=)?%s/i', '', $parts[1]);
        $urlSearch = preg_replace('/\s/', '', mb_substr($line, mb_strlen($title)));
        $bookmarks[$key] = array('url' => $url, 'urlSearch' => $urlSearch);
      }
    }
    $q = trim(preg_replace('/\s+/', ' ', $q));
    list($a) = explode(' ', $q);
    if (preg_match('/https?:\/\/.*/', $q))
      $url = $q;
    else{
      if (mb_substr($q, -1) == '.'){
        $a = 'o';
        $q = mb_substr($q, 0, -1);
      }
      elseif (isset($bookmarks[$a]))
        $q = trim(mb_substr($q, mb_strlen($a)));
      else
        $a = 'g';
      if (empty($q))
        $url = $bookmarks[$a]['url'];
      else
        $url = str_replace('%s', $q, $bookmarks[$a]['urlSearch']);
    }
    header('Location: ' . $url, true, 302);
    die();
  }
  ob_flush();
?>-->
