<!DOCTYPE HTML>
<html lang="en">
<head>
  <title>Q bar</title>
  <meta charset="utf-8">
  <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAEx0lEQVRYw72XTWxUVRTHf+d2KKWhhU7RXtIEkKoxhpl5inz4kWgIG6MhMS7cmaDixoVBIiZGQnTDxoSFgQRdmKhRY1ywNkZjMAZR9M4UbKCJH5TKHQqlVChtkXddeKa5PGboFAgnmUzy3v3433v+5/8/T2gykiQxgAGWAkuAFBDgAjAMTDrnAnMMmWVTARYCfcA6oAQUgLuAKwroLFABysAhYAA455y7clMAkiRpB1YDzwJPAiuA1lnW+xv4FvgS+M45d+6GACRJ0gs8A7ysJ55reOBD4FPn3JHrDWyps3kfsA14FVheZ84lPelfwDgwD5ifGbNQU7bSWvun936oKQB68m3AZmBRZuww8APwhZ7uI+Ab4BgwpkC6dWwAcsqdXmvtoPd++Lop0Jy/ALwDdOkiAlwGDgD7lGSnnXMT0bxWIA+sUuBPKfja/CngY2CHc87XBaBsfwzYk8n5tJ50N3BsNmYnSWKBl4CtCqoGoqoH+8A5d/maFFhrO4BXgE3Ru8u6+S7n3HHv/aw17r2/YK0tK/A1QFvEifnAQe/9mXiO0f8+LbU4DgC7nXO/z4X+zrnzwF7g8+wFAeuTJLmKd0YVbp3WeUy4fUqwOYdzbhx4D/gletwNrM2SuyavpYzI9AOHmlWzBjEIfJ3h233A4iyApRniXQJ+BE5zc/Ev8D0Q53w50KeknwGwRLW9FqeBX+NSu8E0pMBv6g21uBPojfXHqKvFVz0GnODWxAgQq2Cqv6tSIFE1ACzQGr4V0ZFZy2T9x6ifn42e2f81JWltdpdCobCwVCo9XSgUNmSs/B7g/mjouN5wGgMYVj+vRaeWS77JzduNMa+LyB5jzPvFYvH5aO31wLJo+AlgUPkxM2hSm4msaKxqBoAxZhOwBVgmIn0i8m6hUNii1bUxM/x4piow2kYdUoutxb3AZtX260YIYaqW1xBCEJE7jDG70jTdDTweDb0AHNYUXOMFEyoSxejdMmDSWlv23k81AtDd3T1ojOkA1ohIawgBEWnX9VpEZjhXAfY554bqAZjSUnxCjSOokSTAtLW20gjEyMhI6OrqOpDL5fIi8oCI5BTEzM4iclEteb/3/lo39N4Ha20VaFdfyCmIdnW1pdbaP6y15621IXbGJEkkl8uJiBwJIWwUESsioiAQEUIIR0Vkp3PuVMOOyHs/qSBWqjua6CYeUkavANqstVf0twR4EHgOeE1E1oUQWvTURDfQFkL4uVqtHp21KU2S5BHgLWBDnV4PZfGAKlxe6zwuNdI0xZgZbQuAhBCGQwhviMhn5XI5bdiUeu+HrLWDmoZe5UQc7WoqBeDuOr0jInIxhHBSRDpDCAYIItIpIg8DQ52dnQOjo6OhLgAFMWyt/UmNab6K04LZPmS01CpKuJ3AuIisFpF5ehMdwNpcLjdarVbLDQFE7ZUDDuqVn9INgnbAk9q2nQGOaof8iTYy+8vl8smenp6DIhK0ukR1YjHwaE9Pz4l8Pj8gzaidtlGLtJno09TUvg3HtPk4A4w556bjuaVSqQPYDmxXnQhaJYfTNN0gc7U3NZn45tJY2xv4RZsxZoeIvBkp6N40TbcKtymKxeICEdkKvAh8FUJ4u1Kp+NsGQEG0Al0hhH/6+/snAP4Dr4a2xSpk5isAAAAASUVORK5CYII=">
</head>
<body>
  <form id="form" action="index.html" method="GET">
    <input class="query" id="q" type="text" name="q" value="" autofocus /><!--
 --><input class="button" type="submit" value="Q" />
  </form>
  <div class="info" id="info"></div>
</body>

<!-- CONFIG -->
<script type="text/javascript">
engines = [
  {
    k:'g', n:'google',
    u:'https://google.com',
    s:'https://google.com/search?q=%s',
  }, {
    k:'y', n:'youtube',
    u:'https://www.youtube.com',
    s:'https://www.youtube.com/results?search_query=%s',
  }, {
    k:'m', n:'google maps',
    u:'https://maps.google.com',
    s:'https://maps.google.com/maps?q=%s',
  }, {
    k:'i', n:'google images',
    u:'https://google.com/imghp',
    s:'https://google.com/search?tbm=isch&q=%s',
  }, {
    k:'d', n:'duck duck go',
    s:'https://duckduckgo.com/?k1=-1&kp=-1&q=%s',
  }, {
    k:'gh', n:'github',
    u:'https://github.com/unu',
    s:'https://github.com/search?q=%s',
  }, {
    k:'a', n:'alternativeto',
    u:'http://alternativeto.net',
    s:'http://alternativeto.net/SearchResult.aspx?profile=all&search=%s',
  }, {
    k:'w', n:'wikipedia.cz',
    u:'https://cs.wikipedia.org',
    s:'https://cs.wikipedia.org/w/index.php?search=%s',
  }, {
    k:'r', n:'rlslog',
    u:'http://www.rlslog.net',
    s:'http://www.rlslog.net/?s=%s',
  }, {
    k:'u', n:'ulož.to',
    u:'http://www.uloz.to',
    s:'http://www.uloz.to/hledej/?q=%s',
  }, {
    k:'c', n:'čsfd',
    u:'http://www.csfd.cz',
    s:'http://www.csfd.cz/hledat/?q=%s',
  }, {
    k:'t', n:'titulky',
    u:'http://www.titulky.com',
    s:'http://www.titulky.com/index.php?Fulltext=%s',
  }, {
    k:'cs', n:'en > cs',
    u:'http://translate.google.com',
    s:'http://translate.google.com/#en|cs|%s',
  }, {
    k:'en', n:'cs > en',
    u:'http://translate.google.com',
    s:'http://translate.google.com/#cs|en|%s',
  }, {
    k:'rss', n:'google reader',
    u:'https://reader.google.com',
  }, {
    k:'gm', n:'gmail',
    u:'https://mail.google.com',
  }, {
    k:'+', n:'google+',
    u:'https://plus.google.com',
  }, {
    k:'db', n:'dropbox',
    u:'https://dropbox.com',
  }, {
    k:'gb', n:'gimme bar',
    u:'https://gimmebar.com',
  }, {
    k:'x', n:'xkcd',
    u:'https://xkcd.com/',
  }, {
    k:'l', n:'localhost',
    u:'http://localhost',
  },
]
debug = false

// FUNCTIONS
function get_param() {
  a = {}
  window.location.href.replace(/[?&]+([^=&]+)=?([^&]*)/gi, 
    function(m,k,v){
      try{ a[k] = decodeURIComponent(v).replace(/\+/g, ' ') }
      catch(err){ a[k] = '' } // %s bug in firefox
    })
  return a
}
function info(s, a){
  box = document.getElementById('info')
  if (a) box.innerHTML += s
  else   box.innerHTML  = s
}
function shrink(s){
  return s.trim().replace(/ +/g, ' ')
}
function list(){
  m = ''
  e = ''
  for (i in engines){
    s = '<b>' + engines[i].k + '</b> ' + engines[i].n + '<br>'
    if (engines[i].s) e += s
    else m += s
  }
  info('<div class="engines"><h3>engines</h3>' + e + '</div>'
     + '<div class="bookmarks"><h3>bookmarks</h3>' + m + '</div>')
}
function get_engine(k, s){
  for (i in engines){
    if (engines[i].k == k){
      if (!(!engines[i].s && s))  return engines[i]
    }
  }
}
function search(q, go){
  full = q
  q = shrink(q)
  a = q.split(' ')[0]
  s = q.substr(a.length).trim()
  // list commands
  if (q == "ls" || !q || q == '%s') list()
  // load url
  else if (q.match(/^https?:\/\/[^ ]+$/i) || full.match(/^[^ ]+\.[^ ]{2,}$/)){
    if (!q.match(/^https?:\/\/[^ ]+$/i)) q = 'http://' + q
    info('Go to: <a href="' + q + '">' + q + '</a>')
    if (!debug && go) window.location.assign(q)
  }
  // search or bookmark
  else {
    e = get_engine(a, s)
    // default engine
    if (!e){
      e = engines[0]
      s = q
    }
    // search
    if ((e.s && s) || (!e.u && !s)){
      url = e.s.replace(/%s/gi, encodeURIComponent(s))
    }
    // bookmark
    else url = e.u
    info('<b>' + e.n + '</b> ' + ((!s && e.s)?'...':s) + '<br>')
    info('<a href="' + url + '">' + url + '</a>', true)
    if (!debug && go) window.location.assign(url)
  }
}

// ONLOAD
window.onload = function(){
  q = document.getElementById('q')
  form = document.getElementById('form')
  q.value = ''
  q.focus()
  if (get_param().d != undefined) debug = true
  form.onsubmit = function(){
    search(q.value, true)
    return false
  }
  q.onkeyup = function(){
    search(q.value)
  }
  if (get_param().q){
    q.value = get_param().q
    search(q.value, true)
  }
  else search(q.value)
}
</script>

<!-- STYLE -->
<style>
body{
  margin: 0 auto;
  margin-top: 4em;
  width: 25em;
  font-size: 18px;
  font-family: "Droid Sans", "Tahoma", sans;
  color: #222;
}
:focus{
  outline:none
}
::-moz-focus-inner{
  border: 0;
}
a{
  text-decoration: none
}
a, a:visited{
  color: #bbb
}
a:hover{
  color: #888
}
a:active{
  color: #555
}
h3{
  margin: 0 0 .5em
}
form{
  font-family: inherit
  height: 50px;
}
input{
  padding: 10px;
  border: 1px solid #aaa;
  font-size: inherit;
  margin-bottom: 1em;
}
.button{
  border-radius: 0 6px 6px 0;
  background-color: #f5f5f5;
  cursor: pointer;
  width: 60px;
}
.button:hover{
  background-color: #fff
}
.button:active{
  background-color: #eee
}
.query{
  background-color: #fff;
  width: 20em;
  border-right: none;
  border-radius: 6px 0 0 6px;
  box-shadow: 0 0 4px #eee inset;
}
.info{
  padding: .5em;
}
.info b{
  display: inline-block;
  min-width: 2em;
}
.engines, .bookmarks{
  float: left;
  margin-right: 2em;
  min-width: 40%;
}
</style>

</html>
