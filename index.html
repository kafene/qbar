<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Q bar</title>
</head>
<body>
  <form id="form" action="index.html" method="GET">
    <input class="query" id="q" type="text" name="q" value="" autofocus />
    <input class="button" type="submit" value="Q" />
  </form>
  <div class="info" id="info"></div>
</body>


<!-- STYLE -->
<style>
:focus {outline:none}
::-moz-focus-inner {border:0}
body{
  margin: 0 auto;
  margin-top: 10em;
  width: 30em;
  font-size: 20px;
}
a, a:visited{
  color: #bbb;
  text-decoration: none;
}
a:hover{
  color: #888;
}
a:active{
  color: #555;
}
h3{
  margin: .7em 0 .2em;
}
form{
  font-family: "Droid Sans", "Tahoma", sans;
}
input{
  padding: .5em;
  border: 1px solid #aaa;
  background-color: #f8f8f8;
  font-size: 20px;
  width: 3em;
  margin-bottom: 1em;
  border-radius: 3px;
}
.button:hover{
  background-color: #fff;
}
.button:active{
  background-color: #eee;
}
.query{
  width: 25em;
}
.info{
  padding: .5em;
}
.info b{
  min-width: 2em;
  display: inline-block;
}
</style>


<!-- SCRIPT -->
<script type="text/javascript">

// CONFIG
engines = [
  {
    k:'g', n:'google',
    u:'https://google.com',
    s:'https://google.com/search?q=%s',
  }, {
    k:'y', n:'youtube',
    u:'https://www.youtube.com',
    s:'https://www.youtube.com/results?search_query=%s',
  }, {
    k:'m', n:'google maps',
    u:'https://maps.google.com',
    s:'https://maps.google.com/maps?q=%s',
  }, {
    k:'i', n:'google images',
    u:'https://images.google.com',
    s:'https://images.google.com/search?tbm=isch&q=%s',
  }, {
    k:'d', n:'duck duck go',
    s:'https://duckduckgo.com/?k1=-1&kp=-1&q=%s',
  }, {
    k:'gh', n:'github',
    u:'https://github.com/unu',
    s:'https://github.com/search?q=%s',
  }, {
    k:'a', n:'alternativeto',
    u:'http://alternativeto.net',
    s:'http://alternativeto.net/SearchResult.aspx?profile=all&search=%s',
  }, {
    k:'w', n:'wikipedie.cz',
    u:'https://cs.wikipedia.org',
    s:'https://secure.wikimedia.org/wikipedia/cs/wiki/%s',
  }, {
    k:'r', n:'rlslog',
    u:'http://www.rlslog.net',
    s:'http://www.rlslog.net/?s=%s',
  }, {
    k:'u', n:'ulož.to',
    u:'http://www.uloz.to',
    s:'http://www.uloz.to/hledej/?q=%s',
  }, {
    k:'c', n:'čsfd',
    u:'http://www.csfd.cz',
    s:'http://www.csfd.cz/hledat/?q=%s',
  }, {
    k:'t', n:'titulky',
    u:'http://www.titulky.com',
    s:'http://www.titulky.com/index.php?Fulltext=%s',
  }, {
    k:'rss', n:'google reader',
    u:'https://reader.google.com',
  }, {
    k:'gb', n:'gimme bar',
    u:'https://gimmebar.com',
  }, {
    k:'x', n:'xkcd',
    u:'https://xkcd.com/',
  },
];
debug = false;

// FUNCTIONS
function get_param() {
  a = {};
  window.location.href.replace(/[?&]+([^=&]+)=?([^&]*)/gi, 
    function(m,k,v){ a[k] = decodeURIComponent(v); });
  return a;
}
function info(s, a){
  box = document.getElementById('info');
  if (a) box.innerHTML += s;
  else   box.innerHTML  = s;
}
function shrink(s){
  return s.trim().replace(/ +/g, ' ');
}
function list(){
  m = '';
  e = '';
  for (i in engines){
    s = '<b>' + engines[i].k + '</b> ' + engines[i].n + '<br>';
    if (engines[i].s) e += s;
    else m += s;
  }
  info('<h3>Engines</h3>' + e + '<h3>Bookmarks</h3>' + m);
}
function get_engine(k, s){
  for (i in engines){
    if (engines[i].k == k){
      if (!(!engines[i].s && s))  return engines[i];
    }
  }
}
function search(q, go){
  q = shrink(q);
  a = q.split(' ')[0];
  s = q.substr(a.length).trim();
  if (a == "ls" || !q) list();
  else if (q.match(/^https?:\/\/.*$/i)){
    info('Go to: <a href="' + q + '">' + q + '</a>');
    if (!debug && go) window.location.assign(q);
  }
  else {
    e = get_engine(a, s);
    if (!e){
      e = engines[0];
      s = q;
    }
    name = e.n;
    if ((e.s && s) || (!e.u && !s)){
      url = e.s.replace(/%s/gi, encodeURIComponent(s));
    }
    else{
      url = e.u;
    }
    info('<b>' + name + '</b> ' + ((!s && e.s)?'...':s) + '<br>');
    info('<a href="' + url + '">' + url + '</a>', true);
    if (!debug && go) window.location.assign(url);
  }
}

// ONLOAD
window.onload = function(){
  q = document.getElementById('q');
  form = document.getElementById('form');
  q.value = '';
  q.focus();
  if (get_param().d != undefined) debug = true;
  form.onsubmit = function(){
    search(q.value, true);
    return false;
  };
  q.onkeyup = function(){
    search(q.value);
  };
  if (get_param().q){
    q.value = get_param().q;
    search(q.value, true);
  }
  else search(q.value);
};

</script>
</html>
